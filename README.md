# Виджет банковских операций

Этот проект предоставляет виджет для отображения и обработки данных о банковских операциях.  Он включает функции фильтрации и сортировки операций.

## Установка

1. Клонируем репозиторий: `git clone <repository_url>`
2. Установите зависимости: "pip install -r requirements.txt` (Создайте `requirements.txt` с библиотекой `масок` внутри)

## Usage

Основным скриптом является `main.py`.  Он импортирует функции из модуля "src/processing.py`, "src/masks.py` и `src/generators.py`.

Для запуска скрипта:
```bash
python main.py
```

Пример ▌
=======
Скрипт использует примеры данных для демонстрации функциональности.   
Вы можете изменить test_data в main.py, чтобы использовать свои собственные данные. 
Скрипт main.py Теперь также демонстрирует использование декоратора @log. 
Журналы будут выводиться на консоль, если при
применении декоратора не указано имя файла (например, @log(имя файла="app.log")).

▌Функции
=======
• decorators.py: Содержит средство оформления журнала для автоматического ведения журнала выполнения функции,
включая успешные результаты и исключения.

• filter_by_state(операции, состояние="ВЫПОЛНЕНО"): Фильтрует список справочников операций по ключу состояния.
   Возвращает новый список, содержащий только операции с указанным состоянием.

• sort_by_date(операции, reverse=True): Сортирует список справочников операций по ключу даты.
   Возвращает новый список, отсортированный по дате, по умолчанию в порядке убывания.

• mask_account_card(данные): маскирует конфиденциальную информацию в номерах счетов или карт. 
   Автоматически определяет тип данных и применяет соответствующую маскировку.

• get_data(date_string): Преобразует строки дат в определенный формат (ДД.ММ.ГГГГ).

• get_mask_card_number(номер карты): маскирует номер карты, показывая только первые 6 и последние 4 цифры.

• get_mask_account(номер учетной записи): маскирует номер учетной записи, показывая только последние 4 цифры.

• filter_by_currency(транзакции, код валюты): Фильтрует список транзакций на основе указанного кода валюты.

• transaction_descriptions(транзакции): извлекает описание каждой транзакции из списка.

• card_number_generator (начало, конец): генерирует последовательность отформатированных номеров карточек в заданном диапазоне, что полезно для тестирования.

• calculate_transaction_amount: для конвертации суммы транзакции в рубли с использованием внешнего API.
- Важно указать, что требуется API-ключ, хранящийся в переменных окружения через `.env`.

• filter_transactions_by_description для фильтрации транзакций по регулярному выражению в описании.

• csv_to_list и xlsx_to_list для чтения данных из CSV и XLSX файлов.

• load_transactions для загрузки транзакций из JSON-файла с логированием ошибок.

• mask_account_card и get_date уже описаны, но можно уточнить их взаимодействие с другими модулями.

• Декоратор log для логирования выполнения функций. В README уже есть раздел, но можно дополнить примерами использования и параметрами.
▌Средство оформления журнала
====
Декоратор @log используется для автоматического ведения журнала выполнения функций.

▌ИСПОЛЬЗОВАНИЕ:
===
из журнала импорта декораторов
````
@
log определяет мою функцию(x, y):
    возвращает x + y

@log(имя файла="mylog.txt")
определяет другую функцию(x, y):
    вызвать ValueError("Что-то пошло не так")
````
▌Особенности:
=
• Регистрирует начало и окончание выполнения функции.
• Регистрирует успешные результаты.
• Регистрирует исключения, включая тип исключения, сообщение и входные аргументы.
• Может выполнять вход в консоль или в файл.

▌Тестирование
==
Этот проект включает в себя полный набор тестов, написанных с использованием pytest. Тесты охватывают следующие аспекты:

▌Покрытие тестами
==
• masks.py:
  • Корректно маскирует номера карточек разного формата и длины.
  • Корректно маскирует номера счетов разной длины.
  • Обрабатывает крайние случаи, такие как пустые строки и отсутствие входных данных.

• widget.py:
  • Корректно идентифицирует и маскирует номера карточек и счетов в зависимости от типа ввода.
  • Преобразует строки дат в желаемый формат (ДД.ММ.ГГГГ).
  • Корректно обрабатывает недопустимые форматы дат (возвращает значение None или создает исключение в зависимости от реализации).

• processing.py:
  • Корректно фильтрует списки словарей операций на основе состояния.
  • Корректно сортирует списки справочников операций по дате как в порядке возрастания, так и в порядке убывания.
  • Обрабатывает пропущенные или неверные даты в данных.

• tests/test_generators.py:
  • Точно фильтрует списки транзакций по коду валюты.
  • Корректно извлекает описания транзакций из списков транзакций.
  • Генерирует действительные номера карт в пределах указанного диапазона.

▌Запуск тестов
==
1. Убедитесь, что у вас установлен pytest (pip install pytest).
2. Перейдите в корневой каталог проекта (где находится папка tests/).
3. Запустите тесты, используя следующую команду:  
````bash
pytest
 ````
4. Чтобы сгенерировать отчет о покрытии (показывающий, какие части кода были протестированы), используйте: 
````bash
pytest --cov=.
````

Это запустит все тесты в каталоге tests/ и отобразит результаты. Также будет сгенерирован отчет о покрытии, в котором будет указан процент кода, пройденного тестами. Вы можете просмотреть подробный отчет в формате HTML с помощью:
````bash
pytest --cov=. --cov-html-отчет
````

Это создаст html-каталог cov с файлом index.html для просмотра результатов охвата в вашем браузере.